import{c as U,r as u,j as e,F as q,H as G}from"./app-DhMxmlnQ.js";import{H as J}from"./heading-hZ5llr03.js";import{I as m}from"./input-error-MMwtQsxQ.js";import{B as $,a as O}from"./app-logo-icon-X3GIZxfD.js";import{C as K,c as Q,a as W,b as X,d as Y}from"./card-DxlLJTeC.js";import{A as Z,a as R,b as T,c as z}from"./app-layout-CNfg1OHM.js";import{d as ee,e as se,c as te,D as ae,a as le,b as re,f as ne,g as ie}from"./dialog-BS7NebJX.js";import{I as E}from"./input-BYI6z9RA.js";import{L as o}from"./label-DLSaM3DW.js";import{a as ce,c as de}from"./index-eH4SHpJj.js";/* empty css            */import"./index-CLgheG93.js";import"./index-B-t1sK0C.js";import"./index-DtzRoMoA.js";const oe=[{title:"セッション作成",href:de().url}];function ke(a){const s=U.c(28),{friends:n}=a,[x,B]=u.useState(4);let h;s[0]===Symbol.for("react.memo_cache_sentinel")?(h=[],s[0]=h):h=s[0];const[i,H]=u.useState(h),[I,M]=u.useState(!1);let p;s[1]===Symbol.for("react.memo_cache_sentinel")?(p=[1,2,3,4],s[1]=p):p=s[1];const P=p;let j;if(s[2]!==n||s[3]!==i){let r;s[5]!==i?(r=c=>i.includes(c.id),s[5]=i,s[6]=r):r=s[6],j=n.filter(r),s[2]=n,s[3]=i,s[4]=j}else j=s[4];const f=j,l=Math.max(x-1,0),g=Math.max(l-i.length,0);let b,y;s[7]!==n?(b=()=>{const r=new Set(n.map(he));H(c=>c.filter(d=>r.has(d)))},y=[n],s[7]=n,s[8]=b,s[9]=y):(b=s[8],y=s[9]),u.useEffect(b,y);let N,v;s[10]!==l?(N=()=>{H(r=>r.length<=l?r:r.slice(0,l))},v=[l],s[10]=l,s[11]=N,s[12]=v):(N=s[11],v=s[12]),u.useEffect(N,v);let C;s[13]!==l?(C=r=>{H(c=>c.includes(r)?c.filter(t=>t!==r):l===0||c.length>=l?c:[...c,r])},s[13]=l,s[14]=C):C=s[14];const A=C,V=ue;let S;s[15]===Symbol.for("react.memo_cache_sentinel")?(S=e.jsx(G,{title:"セッション作成"}),s[15]=S):S=s[15];let F;s[16]===Symbol.for("react.memo_cache_sentinel")?(F=e.jsx(J,{title:"セッションを作成",description:"参加メンバーとルールを設定して半荘の記録を始めましょう"}),s[16]=F):F=s[16];let w;s[17]===Symbol.for("react.memo_cache_sentinel")?(w=e.jsxs(W,{children:[e.jsx(X,{children:"基本情報"}),e.jsx(Y,{children:"名前や参加人数、ルールを設定してください。"})]}),s[17]=w):w=s[17];let D;s[18]===Symbol.for("react.memo_cache_sentinel")?(D=ce.form(),s[18]=D):D=s[18];let _;return s[19]!==n||s[20]!==I||s[21]!==l||s[22]!==x||s[23]!==g||s[24]!==i||s[25]!==f||s[26]!==A?(_=e.jsxs(Z,{breadcrumbs:oe,children:[S,e.jsxs("div",{className:"mx-auto max-w-4xl space-y-8",children:[F,e.jsxs(K,{children:[w,e.jsx(Q,{children:e.jsx(q,{...D,className:"space-y-8",children:r=>{const{processing:c,errors:d}=r;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"name",children:"セッション名（任意）"}),e.jsx(E,{id:"name",name:"name",placeholder:"例: 2/12 夜会",autoComplete:"off"}),e.jsx(m,{message:d.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"player_count",children:"参加人数"}),e.jsxs("select",{id:"player_count",name:"player_count",defaultValue:x,onChange:t=>B(Number(t.target.value)),className:"rounded-md border border-input bg-transparent px-3 py-2 text-sm",children:[e.jsx("option",{value:4,children:"4人打ち"}),e.jsx("option",{value:3,children:"3人打ち"})]}),e.jsx(m,{message:d.player_count})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-end sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs(o,{children:["招待するフレンド（最大 ",l," 人）"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["選択済み ",i.length," / ",l]})]}),e.jsxs(ee,{open:I,onOpenChange:M,children:[e.jsx(se,{asChild:!0,children:e.jsx($,{type:"button",variant:"outline",disabled:n.length===0,children:"フレンドを選ぶ"})}),e.jsxs(te,{className:"sm:max-w-xl",children:[e.jsxs(ae,{children:[e.jsx(le,{children:"フレンドを選択"}),e.jsx(re,{children:"招待したいフレンドをタップして選択・解除できます。"})]}),n.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"招待できるフレンドがまだいません。まずはフレンドリストから追加してください。"}):e.jsx("div",{className:"max-h-[60vh] space-y-2 overflow-y-auto",children:n.map(t=>{const k=i.includes(t.id),L=!k&&l!==0&&i.length>=l;return e.jsxs("button",{type:"button",onClick:()=>A(t.id),className:O("flex w-full items-center gap-3 rounded-lg border px-3 py-2 text-left transition",k&&"border-primary bg-primary/10",L&&"cursor-not-allowed opacity-60"),disabled:L,children:[e.jsxs(R,{className:"size-12",children:[e.jsx(T,{src:t.avatar,alt:t.name}),e.jsx(z,{children:V(t.name)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.friend_code})]}),e.jsx("span",{className:O("text-sm font-semibold",k?"text-primary":"text-muted-foreground"),children:k?"選択中":"選択"})]},t.id)})}),e.jsxs(ne,{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:l===0?"参加人数の設定により招待枠はありません":g===0?"必要人数をすべて選択済みです":`あと${g}人選べます`}),e.jsx(ie,{asChild:!0,children:e.jsx($,{type:"button",children:"完了"})})]})]})]})]}),n.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"招待可能なフレンドがいません。フレンドページから追加してください。"}):f.length===0?e.jsx("div",{className:"rounded-lg border border-dashed p-4 text-sm text-muted-foreground",children:"まだフレンドを選択していません。上の「フレンドを選ぶ」ボタンから招待してください。"}):e.jsx("div",{className:"flex flex-wrap gap-3",children:f.map(t=>e.jsxs("div",{className:"flex items-center gap-3 rounded-lg border bg-muted/40 px-3 py-2",children:[e.jsxs(R,{className:"size-9",children:[e.jsx(T,{src:t.avatar,alt:t.name}),e.jsx(z,{children:V(t.name)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:t.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.friend_code})]})]},t.id))}),e.jsx("div",{className:"hidden","aria-hidden":"true",children:i.map(xe)}),e.jsx(m,{message:d.member_ids})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"rules_base",children:"基準点 (base)"}),e.jsx(E,{id:"rules_base",name:"rules[base]",type:"number",step:"100",defaultValue:25e3}),e.jsx(m,{message:d["rules.base"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"rules_k",children:"係数 (k)"}),e.jsx(E,{id:"rules_k",name:"rules[k]",type:"number",step:"0.01",defaultValue:.1}),e.jsx(m,{message:d["rules.k"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"順位ボーナス (rank bonus)"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:P.filter(t=>t<=x).map(me)}),e.jsx(m,{message:d["rules.rank_bonus"]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx($,{type:"submit",disabled:c,children:"セッションを作成"})})]})}})})]})]})]}),s[19]=n,s[20]=I,s[21]=l,s[22]=x,s[23]=g,s[24]=i,s[25]=f,s[26]=A,s[27]=_):_=s[27],_}function me(a){return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{htmlFor:`rank_bonus_${a}`,children:[a,"位"]}),e.jsx(E,{id:`rank_bonus_${a}`,name:`rules[rank_bonus][${a}]`,type:"number",step:"100",defaultValue:a===4?-3e3:a===3?0:a===2?1e3:2e3})]},a)}function xe(a){return e.jsx("input",{type:"hidden",name:"member_ids[]",value:a},a)}function ue(a){return a?a.trim().slice(0,2).toUpperCase():"?"}function he(a){return a.id}export{ke as default};
