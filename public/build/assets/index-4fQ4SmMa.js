import{c as me,r as oe,j as t,F as K,H as je}from"./app-DhMxmlnQ.js";import{H as ye}from"./heading-hZ5llr03.js";import{I as ge}from"./input-error-MMwtQsxQ.js";import{b as be,a as Ne,B as F}from"./app-logo-icon-X3GIZxfD.js";import{C as V,c as Y,a as J,b as W,d as X}from"./card-DxlLJTeC.js";import{a as ae,b as ce,c as de,A as _e,i as ve}from"./app-layout-CNfg1OHM.js";import{D as qe,a as Ce,b as we,c as Re,d as Se}from"./dialog-BS7NebJX.js";import{I as Fe}from"./input-BYI6z9RA.js";import{L as Ae}from"./label-DLSaM3DW.js";import{q as se,a as ue}from"./index-DtzRoMoA.js";import{C as De}from"./copy-DKlyGXFs.js";/* empty css            */import"./index-CLgheG93.js";import"./index-B-t1sK0C.js";const Qe=[["path",{d:"M2 21a8 8 0 0 1 13.292-6",key:"bjp14o"}],["circle",{cx:"10",cy:"8",r:"5",key:"o932ke"}],["path",{d:"M19 16v6",key:"tddt3s"}],["path",{d:"M22 19h-6",key:"vcuq98"}]],ke=be("UserRoundPlus",Qe),c=s=>({url:c.url(s),method:"post"});c.definition={methods:["post"],url:"/friend-requests"};c.url=s=>c.definition.url+se(s);c.post=s=>({url:c.url(s),method:"post"});const fe=s=>({action:c.url(s),method:"post"});fe.post=s=>({action:c.url(s),method:"post"});c.form=fe;const d=(s,e)=>({url:d.url(s,e),method:"patch"});d.definition={methods:["patch"],url:"/friend-requests/{friendRequest}/accept"};d.url=(s,e)=>{(typeof s=="string"||typeof s=="number")&&(s={friendRequest:s}),typeof s=="object"&&!Array.isArray(s)&&"id"in s&&(s={friendRequest:s.id}),Array.isArray(s)&&(s={friendRequest:s[0]}),s=ue(s);const a={friendRequest:typeof s.friendRequest=="object"?s.friendRequest.id:s.friendRequest};return d.definition.url.replace("{friendRequest}",a.friendRequest.toString()).replace(/\/+$/,"")+se(e)};d.patch=(s,e)=>({url:d.url(s,e),method:"patch"});const xe=(s,e)=>({action:d.url(s,{[e?.mergeQuery?"mergeQuery":"query"]:{_method:"PATCH",...e?.query??e?.mergeQuery??{}}}),method:"post"});xe.patch=(s,e)=>({action:d.url(s,{[e?.mergeQuery?"mergeQuery":"query"]:{_method:"PATCH",...e?.query??e?.mergeQuery??{}}}),method:"post"});d.form=xe;const o=(s,e)=>({url:o.url(s,e),method:"delete"});o.definition={methods:["delete"],url:"/friend-requests/{friendRequest}"};o.url=(s,e)=>{(typeof s=="string"||typeof s=="number")&&(s={friendRequest:s}),typeof s=="object"&&!Array.isArray(s)&&"id"in s&&(s={friendRequest:s.id}),Array.isArray(s)&&(s={friendRequest:s[0]}),s=ue(s);const a={friendRequest:typeof s.friendRequest=="object"?s.friendRequest.id:s.friendRequest};return o.definition.url.replace("{friendRequest}",a.friendRequest.toString()).replace(/\/+$/,"")+se(e)};o.delete=(s,e)=>({url:o.url(s,e),method:"delete"});const pe=(s,e)=>({action:o.url(s,{[e?.mergeQuery?"mergeQuery":"query"]:{_method:"DELETE",...e?.query??e?.mergeQuery??{}}}),method:"post"});pe.delete=(s,e)=>({action:o.url(s,{[e?.mergeQuery?"mergeQuery":"query"]:{_method:"DELETE",...e?.query??e?.mergeQuery??{}}}),method:"post"});o.form=pe;Object.assign(c,c),Object.assign(d,d),Object.assign(o,o);const Ee=[{title:"Friends",href:ve().url}],Te=()=>{const s=me.c(1);let e;return s[0]===Symbol.for("react.memo_cache_sentinel")?(e=new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}),s[0]=e):e=s[0],e};function rt(s){const e=me.c(67),{friendCode:a,friends:A,incomingRequests:m,outgoingRequests:u}=s,l=Te(),[D,re]=oe.useState(!1),[n,ie]=oe.useState(null);let Q;e[0]!==a?(Q=async()=>{try{await navigator.clipboard.writeText(a),re(!0),setTimeout(()=>re(!1),2e3)}catch(r){console.error("Failed to copy friend code",r)}},e[0]=a,e[1]=Q):Q=e[1];const Z=Q,le=ze,ne=Oe;let k;e[2]!==n?.stats?.recent_games?(k=n?.stats?.recent_games??[],e[2]=n?.stats?.recent_games,e[3]=k):k=e[3];const E=k;let T;e[4]===Symbol.for("react.memo_cache_sentinel")?(T=t.jsx(je,{title:"Friends"}),e[4]=T):T=e[4];let H;e[5]===Symbol.for("react.memo_cache_sentinel")?(H=t.jsx(ye,{title:"Friends & invites",description:"Share your code, add friends, and manage invitations before starting a session"}),e[5]=H):H=e[5];let I;e[6]===Symbol.for("react.memo_cache_sentinel")?(I=t.jsxs(J,{children:[t.jsxs(W,{className:"flex items-center gap-2 text-lg",children:[t.jsx(ke,{className:"size-5"}),"Add a friend by code"]}),t.jsx(X,{children:"自分のフレンドコードを共有するか、相手のコードを入力してリクエストを送信します。"})]}),e[6]=I):I=e[6];let L;e[7]===Symbol.for("react.memo_cache_sentinel")?(L=t.jsx("p",{className:"text-sm text-muted-foreground",children:"Your friend code"}),e[7]=L):L=e[7];let f;e[8]!==a?(f=t.jsxs("div",{children:[L,t.jsx("p",{className:"font-mono text-2xl font-semibold tracking-wide",children:a})]}),e[8]=a,e[9]=f):f=e[9];let P;e[10]===Symbol.for("react.memo_cache_sentinel")?(P=t.jsx(De,{className:"size-4"}),e[10]=P):P=e[10];const ee=D?"Copied":"Copy code";let x;e[11]!==D||e[12]!==Z||e[13]!==ee?(x=t.jsxs(F,{type:"button",variant:"outline",className:"sm:w-auto",onClick:Z,disabled:D,children:[P,ee]}),e[11]=D,e[12]=Z,e[13]=ee,e[14]=x):x=e[14];let p;e[15]!==x||e[16]!==f?(p=t.jsxs("div",{className:"flex flex-col gap-4 rounded-lg border bg-muted/30 p-4 sm:flex-row sm:items-center sm:justify-between",children:[f,x]}),e[15]=x,e[16]=f,e[17]=p):p=e[17];let O;e[18]===Symbol.for("react.memo_cache_sentinel")?(O=t.jsx(K,{...c.form(),resetOnSuccess:["friend_code"],className:"space-y-4",children:Pe}),e[18]=O):O=e[18];let h;e[19]!==p?(h=t.jsxs(V,{children:[I,t.jsxs(Y,{className:"space-y-6",children:[p,O]})]}),e[19]=p,e[20]=h):h=e[20];let z;e[21]===Symbol.for("react.memo_cache_sentinel")?(z=t.jsxs(J,{children:[t.jsx(W,{children:"Incoming requests"}),t.jsx(X,{children:"承認待ちのリクエスト。参加してほしい友だちだけ承認してください。"})]}),e[21]=z):z=e[21];let j;e[22]!==m.length?(j=m.length===0&&t.jsx("p",{className:"text-sm text-muted-foreground",children:"No pending requests right now."}),e[22]=m.length,e[23]=j):j=e[23];let y;if(e[24]!==l||e[25]!==m){let r;e[27]!==l?(r=i=>t.jsxs("div",{className:"rounded-lg border p-4",children:[t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("p",{className:"font-medium",children:i.sender?.name}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Code: ",i.sender?.friend_code]}),i.created_at&&t.jsxs("p",{className:"text-xs text-muted-foreground",children:["Sent ",l.format(new Date(i.created_at))]})]}),t.jsxs("div",{className:"mt-4 flex flex-col gap-2 sm:flex-row",children:[t.jsx(K,{...d.form(i.id),children:Le}),t.jsx(K,{...o.form(i.id),children:Ie})]})]},i.id),e[27]=l,e[28]=r):r=e[28],y=m.map(r),e[24]=l,e[25]=m,e[26]=y}else y=e[26];let g;e[29]!==j||e[30]!==y?(g=t.jsxs(V,{children:[z,t.jsxs(Y,{className:"space-y-4",children:[j,y]})]}),e[29]=j,e[30]=y,e[31]=g):g=e[31];let U;e[32]===Symbol.for("react.memo_cache_sentinel")?(U=t.jsxs(J,{children:[t.jsx(W,{children:"Outgoing requests"}),t.jsx(X,{children:"まだ承認されていないリクエスト。取り消したい場合はキャンセルできます。"})]}),e[32]=U):U=e[32];let b;e[33]!==u.length?(b=u.length===0&&t.jsx("p",{className:"text-sm text-muted-foreground",children:"No outgoing requests."}),e[33]=u.length,e[34]=b):b=e[34];let N;if(e[35]!==l||e[36]!==u){let r;e[38]!==l?(r=i=>t.jsxs("div",{className:"flex flex-col gap-3 rounded-lg border p-4 sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-medium",children:i.recipient?.name}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Code: ",i.recipient?.friend_code]}),i.created_at&&t.jsxs("p",{className:"text-xs text-muted-foreground",children:["Sent ",l.format(new Date(i.created_at))]})]}),t.jsx(K,{...o.form(i.id),children:He})]},i.id),e[38]=l,e[39]=r):r=e[39],N=u.map(r),e[35]=l,e[36]=u,e[37]=N}else N=e[37];let _;e[40]!==b||e[41]!==N?(_=t.jsxs(V,{children:[U,t.jsxs(Y,{className:"space-y-4",children:[b,N]})]}),e[40]=b,e[41]=N,e[42]=_):_=e[42];let v;e[43]!==g||e[44]!==_?(v=t.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[g,_]}),e[43]=g,e[44]=_,e[45]=v):v=e[45];let $;e[46]===Symbol.for("react.memo_cache_sentinel")?($=t.jsxs(J,{children:[t.jsx(W,{children:"Friends list"}),t.jsx(X,{children:"追加済みの友だち。セッション作成時にこのリストから招待できます。"})]}),e[46]=$):$=e[46];let q;e[47]!==A?(q=t.jsxs(V,{children:[$,t.jsx(Y,{children:A.length===0?t.jsx("p",{className:"text-sm text-muted-foreground",children:"まだフレンドがいません。コードを共有して追加しましょう。"}):t.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:A.map(r=>t.jsx("div",{className:"rounded-lg border p-4",children:t.jsxs("button",{type:"button",onClick:()=>ie(r),className:"flex w-full items-center gap-4 text-left",children:[t.jsxs(ae,{className:"size-12",children:[t.jsx(ce,{src:r.avatar,alt:r.name}),t.jsx(de,{children:le(r.name)})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"font-medium",children:r.name}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Code: ",r.friend_code]})]}),t.jsx("span",{className:"text-sm font-semibold text-primary",children:"詳細 →"})]})},r.id))})})]}),e[47]=A,e[48]=q):q=e[48];let C;e[49]!==h||e[50]!==v||e[51]!==q?(C=t.jsxs("div",{className:"space-y-8",children:[H,h,v,q]}),e[49]=h,e[50]=v,e[51]=q,e[52]=C):C=e[52];const te=!!n;let B;e[53]===Symbol.for("react.memo_cache_sentinel")?(B=r=>!r&&ie(null),e[53]=B):B=e[53];let M;e[54]===Symbol.for("react.memo_cache_sentinel")?(M=t.jsxs(qe,{children:[t.jsx(Ce,{children:"フレンド詳細"}),t.jsx(we,{children:"累計ポイントと直近10戦の記録を確認できます。"})]}),e[54]=M):M=e[54];let w;e[55]!==l||e[56]!==E||e[57]!==n?(w=n&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs(ae,{className:"size-16",children:[t.jsx(ce,{src:n.avatar,alt:n.name}),t.jsx(de,{children:le(n.name)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-lg font-semibold",children:n.name}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Code: ",n.friend_code]})]})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"累計ポイント"}),t.jsxs("p",{className:"text-3xl font-semibold",children:[ne(n.stats?.total_points)," pt"]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("p",{className:"text-sm font-semibold",children:"直近10戦"}),E.length?t.jsx("div",{className:"max-h-72 space-y-2 overflow-y-auto pr-1",children:E.map(r=>{const i=Number(r.points??0),he=i>0?"text-emerald-600":i<0?"text-rose-600":"text-muted-foreground";return t.jsxs("div",{className:"rounded-lg border p-3",children:[t.jsxs("div",{className:"flex items-center justify-between gap-2 text-sm font-medium",children:[t.jsx("span",{children:r.session?.name??"セッション"}),t.jsxs("span",{className:Ne("font-semibold",he),children:[ne(r.points)," pt"]})]}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.played_at?l.format(new Date(r.played_at)):"日時不明"," ・ ",r.rank,"位"]})]},r.id)})}):t.jsx("p",{className:"text-sm text-muted-foreground",children:"まだ対局データがありません。"})]})]}),e[55]=l,e[56]=E,e[57]=n,e[58]=w):w=e[58];let R;e[59]!==w?(R=t.jsxs(Re,{className:"sm:max-w-lg",children:[M,w]}),e[59]=w,e[60]=R):R=e[60];let S;e[61]!==te||e[62]!==R?(S=t.jsx(Se,{open:te,onOpenChange:B,children:R}),e[61]=te,e[62]=R,e[63]=S):S=e[63];let G;return e[64]!==C||e[65]!==S?(G=t.jsxs(_e,{breadcrumbs:Ee,children:[T,C,S]}),e[64]=C,e[65]=S,e[66]=G):G=e[66],G}function He(s){const{processing:e}=s;return t.jsx(F,{type:"submit",variant:"ghost",className:"w-full sm:w-auto",disabled:e,children:"Cancel request"})}function Ie(s){const{processing:e}=s;return t.jsx(F,{type:"submit",variant:"outline",className:"w-full sm:w-auto",disabled:e,children:"Decline"})}function Le(s){const{processing:e}=s;return t.jsx(F,{type:"submit",className:"w-full sm:w-auto",disabled:e,children:"Accept"})}function Pe(s){const{processing:e,errors:a}=s;return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"grid gap-2 sm:grid-cols-[1fr_auto] sm:items-end",children:[t.jsxs("div",{className:"grid gap-2",children:[t.jsx(Ae,{htmlFor:"friend_code",children:"Friend code"}),t.jsx(Fe,{id:"friend_code",name:"friend_code",placeholder:"e.g. H5KD92PQ",autoComplete:"off",maxLength:12,required:!0}),t.jsx(ge,{message:a.friend_code})]}),t.jsx(F,{type:"submit",className:"w-full sm:w-auto",disabled:e,children:"Send request"})]})})}function Oe(s){return Number(s??0).toLocaleString(void 0,{maximumFractionDigits:1,minimumFractionDigits:0})}function ze(s){return s?s.trim().split(" ").map(Ue).join("").slice(0,2).toUpperCase():"?"}function Ue(s){return s[0]}export{rt as default};
